"use strict";function openSearchField(e){0==searchField?(e.stopPropagation(),searchField=!0,headerSearchInput.focus(),headerSearch.setAttribute("data-active","true"),movieContainer.style="filter: blur(10px)",DOMbody.addEventListener("click",closeSearchField)):(""!=headerSearchInput.value&&console.log("request data "),searchField=!1,headerSearchInput.blur(),headerSearch.setAttribute("data-active","false"),headerSearchInput.value="",movieContainer.style="filter: blur(0px)",DOMbody.removeEventListener("click",closeSearchField))}function keypressSearchField(e){!searchField||13!=e.keyCode&&27!=e.keyCode||openSearchField()}function closeSearchField(e){"header-search-input"!=e.target.id&&openSearchField()}function toggleArranger(e){"false"!=mgArranger.getAttribute("data-open")?mgArranger.setAttribute("data-open","false"):mgArranger.setAttribute("data-open","true")}function getArrangerSettings(){return{filtering:{genre:getArrangerCheckbox(),rating:sliderRating.noUiSlider.get(),runtime:parseData(sliderRuntime.noUiSlider.get()),year:parseData(sliderYear.noUiSlider.get())},sorting:{sortingby:getArrangerRadiobuttons(),sortingorder:getArrangerSortingorder()}}}function parseData(e){for(var t in e)e[t]=parseFloat(e[t]);return e}function getArrangerCheckbox(){for(var e=[],t=0;t<mgFilteringGenre.length;t++)1==mgFilteringGenre[t].checked&&e.push(mgFilteringGenre[t].value);return e}function getArrangerRadiobuttons(){for(var e=0;e<mgRadioInput.length;e++)if(1==mgRadioInput[e].checked)return mgRadioInput[e].value}function getArrangerSortingorder(){return mgSortingOrder[0].checked?mgSortingOrder[0].value:mgSortingOrder[1].value}function compareArranger(){function e(e,t){return JSON.stringify(lastSettings[t])!==JSON.stringify(e[t])}var t=getArrangerSettings();if(e(t,"filtering")){console.log("UPDATE DOM - with new filter");var r={task:"discover",loadState:"loadMore",settings:t};return toggleArranger(),window.lastSettings=t,void loadController(r)}if(e(t,"sorting"))return console.log("UPDATE DOM - with new positioning"),toggleArranger(),void(window.lastSettings=t);console.log("No changes found"),toggleArranger()}function setLastSettings(){window.lastSettings=getArrangerSettings()}function loadMovies(e){return"loadDefault"==e.loadState?(console.log("Loading default movies"),Promise.all([fetchTMDb(e),fetchTMDb(e),fetchTMDb(e)]).then(function(e){return mergeNestedArrays(e)})):"loadMore"==e.loadState?(console.log("Loading more movies"),fetchTMDb(e)):void 0}function loadController(e){loadMovies(e).then(function(e){return movieAPI.setMovieArr(e),e}).then(function(e){return addMovieElements(e)}).catch(function(e){console.log(e),console.log("Failed somewhere at => loadMovies")})}function mergeNestedArrays(e){var t=[];for(var r in e)for(var n in e[r].results)t.push(e[r].results[n]);return t}function addMovieElements(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=document.getElementById("mg-movie-container"),r=document.createDocumentFragment(),n=0;n<e.length;n++){var o=document.createElement("li");o.className="mg-movie-item";var a=document.createElement("div");a.className="mg-movie-image",a.setAttribute("style","background-image: url('http://image.tmdb.org/t/p/w154"+e[n].poster_path+"')");var i=document.createElement("h3");i.className="mg-movie-title",i.innerText=""+e[n].original_title;var l=document.createElement("h4");l.className="mg-movie-year",l.innerText=""+parseFloat(e[n].release_date),o.appendChild(a),o.appendChild(i),o.appendChild(l),r.appendChild(o)}t.appendChild(r)}function fetchTMDb(e){var t="c6aea5536b7de40d0294eb356df3c3df";if("multisearch"==e.task){var r="https://api.themoviedb.org/3/search/multi?api_key="+t+"&language=en-US&query="+e.query+"&page="+e.pageNr+"&include_adult=false";return fetch(r).then(handleErrors).then(function(e){return e.json()}).then(function(e){return console.log(e)}).catch(function(e){return console.log("TMDb data request failed => popularity")})}if("genre"==e.task){var n="https://api.themoviedb.org/3/discover/movie?api_key="+t+"&with_genres="+genreID+"&primary_release_date.gte=2015-01-01&with_original_language=en&vote_count.gte=10&page="+pageNr+"&include_video&popularity.desc";return fetch(n).then(handleErrors).then(function(e){return e.json()}).catch(function(e){return console.log("TMDb data request failed => genre")})}if("actor"==e.task){console.log("called");var o="https://api.themoviedb.org/3/person/"+e.personID+"?api_key="+t+"&language=en-US";return fetch(o).then(handleErrors).then(function(e){return e.json()}).then(function(e){return console.log(e)}).catch(function(e){return console.log("TMDb data request failed => genre")})}if("actorcredits"==e.task){console.log("called");var a="https://api.themoviedb.org/3/person/"+e.personID+"/movie_credits?api_key="+t+"&language=en-US";return fetch(a).then(handleErrors).then(function(e){return e.json()}).then(function(e){return console.log(e)}).catch(function(e){return console.log("TMDb data request failed => genre")})}if("discover"==e.task){console.log("called");assembleURL(e.settings);return fetch("https://api.themoviedb.org/3/discover/movie?api_key=c6aea5536b7de40d0294eb356df3c3df&language=en-US&sort_by=popularity.desc&include_adult=false&include_video=false&page=1").then(handleErrors).then(function(e){return e.json()}).then(function(e){return e}).catch(function(e){return console.log("TMDb data request failed => genre")})}}function handleErrors(e){return e.ok||console.log(movieID+"      <=========== movieID not found"),e}function assembleURL(e){}var DOMbody=document.getElementsByTagName("body")[0],headerSearchLogo=document.getElementById("header-search-logo"),headerSearchInput=document.getElementById("header-search-input"),headerSearch=document.getElementById("header-search"),movieContainer=document.getElementById("mg-movie-container"),searchField=!1;headerSearchLogo.addEventListener("click",openSearchField),headerSearchInput.addEventListener("keydown",keypressSearchField);var mgArranger=document.getElementById("mg-arranger-container"),mgToggle=document.getElementById("mg-toggle"),mgRefresh=document.getElementById("mg-refresh");mgToggle.addEventListener("click",toggleArranger),mgRefresh.addEventListener("click",compareArranger);var mgFilteringGenre=document.getElementsByClassName("mg-checkbox"),mgRadioInput=document.getElementsByClassName("mg-radio-input"),mgSortingOrder=document.getElementsByClassName("mg-sorting-order"),movieAPI=function(){var e=[];return{clearMovies:function(t){e=[]},setMovie:function(t){e.push(t)},setMovieArr:function(t){e=t},getMovie:function(t){return e[t]},getID:function(t){return e[t].id},getMovieArr:function(){return e},getIndex:function(t){for(var r=0;r<e.length;r++)if(e[r].id==t)return r;throw new Error("Couldnt find following ID and thus return index number")}}}();window.onload=function(){setLastSettings(),loadController({task:"discover",loadState:"loadDefault",settings:lastSettings})};var sliderRating=document.getElementById("mg-slider-rating"),sliderRuntime=document.getElementById("mg-slider-runtime"),sliderYear=document.getElementById("mg-slider-year");noUiSlider.create(sliderRating,{start:[6,10],connect:!0,tooltips:[wNumb({decimals:1}),wNumb({decimals:1})],range:{min:[1],max:[10]}}),noUiSlider.create(sliderRuntime,{start:[80,150],connect:!0,animationDuration:300,tooltips:[wNumb({decimals:0}),wNumb({decimals:0})],range:{min:[60],max:[300]}}),noUiSlider.create(sliderYear,{start:[1990,2017],connect:!0,orientation:"vertical",tooltips:[wNumb({decimals:0}),wNumb({decimals:0})],range:{min:[1940],"50%":[2e3],max:[2020]}});